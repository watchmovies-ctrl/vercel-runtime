document.addEventListener('DOMContentLoaded', () => { fetchData(); setInterval(fetchData, 5000); Chart.defaults.color = '#94a3b8'; Chart.defaults.borderColor = 'rgba(255,255,255,0.05)'; }); let charts = {}; function fetchData() { fetch('/api/dashboard').then(r => r.json()).then(updateUI); } function simulateShift() { const btn = document.querySelector('.btn-glow'); btn.innerHTML = '<span>⚙️</span> Processing...'; fetch('/api/simulate').then(() => { fetchData(); setTimeout(() => btn.innerHTML = '<span>⚡</span> Simulate Shift', 500); }); } function updateUI(data) { const s = data.kpi_summary; document.getElementById('kpi-eff').textContent = s.avg_efficiency + '%'; document.getElementById('kpi-active').textContent = s.total_machines; document.getElementById('kpi-delay').textContent = s.delayed_orders; document.getElementById('kpi-bottleneck').textContent = s.bottleneck; const tbody = document.getElementById('dashboard-table'); tbody.innerHTML = ''; data.machines.forEach(m => { tbody.innerHTML += `<tr><td><strong>${m.name}</strong></td><td><span class="status-badge status-${m.status}">${m.status}</span></td><td><div style="display:flex; align-items:center; gap:8px;"><span style="font-size:12px; width:60px;">${m.actual_qty} / ${m.planned_qty}</span><div style="flex:1; height:4px; background:rgba(255,255,255,0.1); border-radius:2px;"><div style="width:${Math.min((m.actual_qty/m.planned_qty)*100, 100)}%; height:100%; background:${m.status === 'Critical' ? '#ef4444' : '#10b981'}; border-radius:2px;"></div></div></div></td><td><strong style="color:${m.status === 'Critical' ? '#ef4444' : '#10b981'}">${m.efficiency}%</strong></td><td>${m.idle_time}h</td></tr>`; }); updateCharts(data.machines); } function updateCharts(machines) { const labels = machines.map(m => m.name); if (charts.eff) charts.eff.destroy(); charts.eff = new Chart(document.getElementById('efficiencyChart'), { type: 'bar', data: { labels: labels, datasets: [{ label: 'Efficiency %', data: machines.map(m => m.efficiency), backgroundColor: machines.map(m => m.efficiency < 75 ? '#ef4444' : '#6366f1'), borderRadius: 4, barThickness: 30 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { display: true, color: 'rgba(255,255,255,0.05)' } } } } }); if (charts.util) charts.util.destroy(); charts.util = new Chart(document.getElementById('utilizationChart'), { type: 'doughnut', data: { labels: labels, datasets: [{ data: machines.map(m => m.utilization), backgroundColor: ['#6366f1', '#8b5cf6', '#ec4899', '#10b981'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } } }, cutout: '75%' } }); }